# 魔都i启航 - iSailing

## 🎮 游戏介绍

魔都i启航是一款经营模拟游戏，玩家在大都市中，通过买卖各种商品来积累财富，同时要处理债务、健康和各种随机事件。本开源项目是基于 **北京浮生记** （由Guo Xianghao于2000-2001年）开发。
魔都i启航，成为一名荣耀上海滩的现代企业家

## ✨ 游戏特色

- **💬 ChatGPT风格对话界面**: 通过自然语言对话进行游戏操作
- **🤖 智能AI助手**: 游戏助手会引导你完成各种操作
- **🎨 Element Plus UI组件**: 使用企业级Vue组件库，提升界面质量
- **📱 响应式设计**: 完美适配桌面和移动设备
- **⚡ 现代化UI**: 流畅动画和精美界面设计
- **🛒 多城市商品系统**：北京、上海、广州三座城市，每座城市有独特的商品
- **📈 动态价格系统**：商品价格实时波动，随机事件影响市场
- **🏢 完整的建筑系统**：银行、医院、工地、房屋扩建、邮局、机场、火车站等
- **🎲 随机事件系统**：商业事件、健康伤害事件、财务损失事件
- **🌍 多城市系统**：可以在不同城市间旅行，体验不同城市的商品市场
- **📦 PWA支持**：可安装为桌面应用，支持离线访问

## 🛠️ 技术栈

- **前端框架**: Vue 3 + TypeScript
- **状态管理**: Pinia
- **路由**: Vue Router
- **UI组件库**: Element Plus + Element Plus X
- **构建工具**: Vite
- **样式**: Element Plus + Tailwind CSS + 自定义CSS
- **PWA**: Vite PWA Plugin (Workbox)

## 🚀 快速开始

### 安装依赖
```bash
pnpm install
```

### 启动开发服务器
```bash
pnpm dev
```

### 构建生产版本
```bash
pnpm build
```

### 代码检查
```bash
pnpm lint
```

## 🎯 游戏规则

### 初始状态
- **现金**: 2000元
- **债务**: 5000元 (每周利息10%)
- **银行存款**: 0元 (每周利息1%)
- **健康**: 100点
- **名声**: 100点
- **仓库容量**: 100单位

### 核心机制
1. **每周循环**: 生成商品价格 → 处理财务 → 随机事件 → 时间递减
2. **商品交易**: 在市场购买商品，存储在仓库中，到下一周出售
3. **建筑服务**:
   - **银行**: 存款取款，利息计算
   - **医院**: 治疗健康，每点350元
   - **工地**: 打工赚取收入（300-500元），消耗健康（2-5点），有15%受伤风险
   - **送外卖**: 花费15元，随机获得10-50元奖金，消耗健康（1-3点）
   - **房屋扩建**: 增加仓库容量，现金>30000元时半价
   - **邮局**: 偿还债务
   - **机场/火车站**: 前往其他城市

### 商品系统

#### 商品ID规则
商品ID采用全局唯一标识：`城市ID * 100000 + 商品index`

- **北京（城市ID=0）**: 商品ID 0-7
- **上海（城市ID=1）**: 商品ID 100000-100007
- **广州（城市ID=2）**: 商品ID 200000-200007

#### 商品列表

**北京**:
- 进口香烟、走私汽车、潮玩手办、山西假白酒、《上海小宝贝》、进口玩具、水货手机、伪劣化妆品

**上海**:
- 进口香烟、走私汽车、潮玩手办、山西假白酒、《上海小宝贝》、进口玩具、水货手机、伪劣化妆品

**广州**:
- 广式点心、进口电子产品、服装批发、茶叶、《岭南文化》、进口水果、手机配件、中药材

### 随机事件

#### 商业事件
- **价格上涨事件**: 影响商品价格上涨（×2 到 ×8）
- **价格下跌事件**: 影响商品价格下跌（÷5 到 ÷8）
- **赠送商品事件**: 随机获得商品，可能强制购买

#### 健康伤害事件
- 各种伤害事件，降低健康值（1-20点）

#### 财务损失事件
- 各种消费事件，直接扣除现金（5%-40%）

### 游戏结束条件
- 时间耗尽（52周）
- 健康值为0
- 债务超过100000元

### 得分计算
```
最终得分 = 现金 + 银行存款 - 债务
```

得分评价：
- **>10000000**: "你的钱太多了，建议向国家申报资产"
- **100000-10000000**: "银行长途电话：'哇！你是大款！'"
- **1000-100000**: "银行长途电话：'嗯，你还可以'"
- **<1000**: "银行长途电话：'你太穷了，去要饭吧！'"

## 📁 项目结构

```
src/
├── components/              # UI 组件
│   └── game/                # 游戏界面组件（抽屉、对话框、聊天等）
├── composables/             # 组合式函数（操作、逻辑、时间、菜单等）
├── core/                    # 核心游戏引擎与领域层
│   ├── base/                # 基类（BaseManager）
│   ├── formatters/          # 格式化器（MarketFormatter）
│   ├── handlers/            # 事件处理器（商业/健康/财务）
│   ├── managers/            # 业务管理器（Goods/GoodsLibrary/Financial/Building/Market/City）
│   ├── models/              # 领域模型（Player/Goods/Building/Market/City）
│   ├── services/            # 服务层（FameService/GoodsFinder）
│   └── GameEngine.ts        # 游戏引擎与流程协调
├── config/                  # 配置（游戏参数、城市、主题、ID 规则）
├── stores/                  # Pinia Store（game.ts，统一初始化/持有 Managers）
├── plugins/                 # Element Plus / Element Plus X 插件与解析器
├── styles/                  # 组件样式定制
├── utils/                   # 工具与调试
└── views/                   # 页面组件
```

## 🎨 界面预览

- **🏠 首页**: 游戏介绍和开始界面
- **💬 游戏界面**: ChatGPT风格的对话界面，通过与AI助手对话进行游戏
- **📖 关于页面**: 游戏介绍和技术说明

### 🎮 操作方式

#### 💬 对话交互
- **自然语言输入**: 在输入框中输入指令，如"购买商品"、"查看市场"等
- **快捷按钮**: 使用底部的快捷操作按钮快速执行常用命令
- **选项选择**: AI助手会提供操作选项，点击即可执行

#### 🎯 常用指令
- `"市场"` 或 `"购买"` - 查看并购买商品
- `"出售"` 或 `"库存"` - 查看并出售商品
- `"服务"` 或 `"建筑"` - 访问各种建筑服务
- `"下一周"` - 进入下一周
- `"状态"` - 查看当前游戏状态

### 🎨 界面特色

#### ✨ 视觉设计
- **毛玻璃效果**: 现代化的背景模糊和透明效果
- **渐变色彩**: 丰富的渐变色彩和动画效果
- **流畅动画**: 消息滑入、按钮悬停等流畅动画
- **响应式布局**: 完美适配桌面和移动设备

#### 🧩 组件系统
- **Element Plus**: 企业级Vue组件库
- **自定义样式**: 精心设计的CSS变量和主题
- **图标系统**: Emoji图标提供更好的视觉识别
- **交互反馈**: 丰富的悬停和点击效果

## 🏗️ 架构设计

### 面向对象设计

项目采用完整的面向对象设计，遵循 SOLID 原则，核心职责划分：

#### 接口抽象层
- `IMessageHandler` / `IGameService` - 规范消息与服务注入

#### 基类设计
- `BaseManager` - 管理器基类，统一注入与通用逻辑

#### 服务层分离
- `FameService` / `GoodsFinder` / `MarketFormatter`

#### 领域模型
- `Player` - 玩家模型，封装玩家状态和操作
- `Goods` - 商品模型，封装商品信息和业务逻辑
- `Building` - 建筑模型，封装建筑信息和配置
- `Market` - 市场模型，封装市场商品集合
- `City` - 城市模型，封装城市信息和访问记录
- `GoodsLibraryManager` - 全局商品库，负责全量初始化与唯一 ID 校验

### 架构层次

```
UI 层：components + views + composables（对接交互）
状态层：stores/game.ts（持有 GameEngine 与 Managers 单例，统一入口）
核心层：GameEngine（调度 PriceGenerator、Managers、Handlers）
领域/服务层：models（Player/Goods/Building/City/Market）、services（FameService/GoodsFinder）、formatters（MarketFormatter）
基础设施层：config（game/cities/theme/city-id）、utils、plugins（Element Plus / Element Plus X）
```

### 设计模式

- **依赖注入**: Manager/Handler 通过构造函数注入配置与接口
- **组合优于继承**: Manager 组合服务与格式化器
- **策略模式**: `MarketFormatter` 可切换/扩展格式化策略
- **集中校验**: `GoodsLibraryManager` 统一初始化与全局唯一 ID 校验，避免遗漏

## 📱 PWA 功能

### 功能特性

1. **Service Worker 离线缓存**
   - 自动缓存静态资源（JS、CSS、HTML、图片等）
   - 支持离线访问
   - 智能缓存策略

2. **Web App Manifest**
   - 应用名称和描述
   - 主题颜色和背景色
   - 应用图标配置
   - 启动画面配置

3. **安装提示**
   - 自动检测是否可安装
   - 友好的安装提示界面
   - 支持添加到主屏幕

4. **更新提示**
   - 检测新版本
   - 提示用户更新
   - 一键更新功能

5. **离线指示器**
   - 显示当前网络状态
   - 离线模式提示

### 图标文件

需要创建以下图标文件（放在 `public` 目录）：
- `favicon.ico` - 网站图标
- `pwa-192x192.png` - PWA 图标 192x192
- `pwa-512x512.png` - PWA 图标 512x512
- `apple-touch-icon.png` - Apple 设备图标 180x180

可以使用 `public/icon-generator.html` 工具生成图标，或使用在线工具如 [PWA Asset Generator](https://github.com/elegantapp/pwa-asset-generator)。

### 部署要求

- PWA功能需要HTTPS才能正常工作（localhost除外）
- 确保所有资源使用相对路径或HTTPS绝对路径
- 确保 `manifest.json` 和 Service Worker 文件可访问

## 🎨 UI组件库

### Element Plus

项目使用 Element Plus 作为主要UI组件库，采用按需导入优化：

- **自动按需导入**: 使用 `unplugin-vue-components` 实现自动按需导入
- **v-model API**: 使用最新的 v-model 语法
- **样式优化**: 统一的组件样式优化，支持响应式和暗色主题

### Element Plus X

集成了 Element Plus X 用于AI相关组件：

- **BubbleList**: 聊天消息气泡列表，支持打字机效果
- **Thinking**: AI思考状态指示器
- **自动导入**: 通过自定义Resolver实现自动按需导入

## 🔧 开发说明

本项目完全基于原版C++游戏逻辑，使用现代Web技术进行重构：

- 保持了所有核心游戏机制
- 优化了用户界面和交互体验
- 添加了响应式设计
- 代码结构清晰，易于维护和扩展
- 采用面向对象设计，遵循SOLID原则
- 完整的领域模型设计

## 📄 开源协议

基于原版游戏的GNU GPL v2.0协议

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！
